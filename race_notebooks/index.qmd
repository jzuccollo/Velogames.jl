---
title: "Velogames solver"
---

Fantasy cycling team optimisation for [Velogames](https://www.velogames.com/). The package scrapes rider data from Velogames and ProCyclingStats, estimates expected Velogames points via Monte Carlo simulation, and selects optimal teams using JuMP/HiGHS linear programming. Building on the work of [GraemeHawker](https://github.com/GraemeHawker/velogames_solver).

# Notebooks

Three notebooks cover the main use cases:

- **[One-day predictor](oneday_predictor.qmd)**: Pre-race team selection for Superclassico Sixes one-day races. Monte Carlo simulation converts rider strength estimates into expected VG points, then optimises a 6-rider team.
- **[Stage race predictor](stagerace_predictor.qmd)**: Pre-race team selection for grand tours and stage races. Class-aware strength estimation blends PCS specialties according to each rider's VG classification (all-rounder, climber, sprinter, unclassed), then optimises a 9-rider team with classification constraints.
- **[Historical analysis](historical_analysis.qmd)**: Retrospective analysis of completed races. Uses actual race results to find the optimal team you could have picked, the cheapest team that beats a benchmark, and rider value analysis. Works for both one-day and stage races.

# Prediction pipeline

Both predictors follow the same pipeline:

1. Fetch VG rider data (costs, season points, and classifications for stage races)
2. Fetch PCS specialty ratings (one-day, GC, TT, sprint, climber)
3. Fetch PCS race-specific history from past editions
4. Optionally fetch betting odds
5. Estimate rider strength via Bayesian updating of all signals
6. Run Monte Carlo simulation to get finishing position probabilities
7. Compute expected VG points (finish + assists + breakaway)
8. Optimise team selection to maximise total expected VG points

The key difference between one-day and stage race prediction is how PCS specialty scores are combined. One-day races use the single relevant specialty (e.g. one-day points for a classic). Stage races blend specialties according to each rider's classification, so an all-rounder's strength reflects GC, TT, and climbing ability whilst a sprinter's reflects sprint and one-day points.

# Optimisation models

## One-day races

For Superclassico Sixes one-day races, teams are 6 riders with no classification constraints:

$$\max \sum_{j=1}^{n} x_j y_j$$

$$\text{s.t.} \quad \sum_{j=1}^{n} x_j = 6, \quad \sum_{j=1}^{n} x_j z_j \leq 100$$

where $x_j \in \{0,1\}$ is whether rider $j$ is selected, $y_j$ is expected VG points, and $z_j$ is cost.

## Stage races

For grand tours, teams are 9 riders with classification constraints:

$$\max \sum_{j=1}^{n} x_j y_j$$

$$\text{s.t.} \quad \sum x_j = 9, \quad \sum x_j z_j \leq 100$$

$$\sum x_j a_j \geq 2, \quad \sum x_j c_j \geq 2, \quad \sum x_j s_j \geq 1, \quad \sum x_j u_j \geq 3$$

where $a_j, c_j, s_j, u_j \in \{0,1\}$ indicate rider $j$'s classification (all-rounder, climber, sprinter, unclassed) with $a_j + c_j + s_j + u_j = 1$ for all $j$.
